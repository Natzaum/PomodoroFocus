<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="PomodoroFocus.TasksPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:local="clr-namespace:PomodoroFocus"
    Title="Tarefas"
    BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Black}}">

    <Grid RowDefinitions="auto,*" Padding="20" RowSpacing="20">

        <!-- Header com estatísticas -->
        <VerticalStackLayout Spacing="15">
            <Label
                FontSize="28"
                FontAttributes="Bold"
                Text="Suas Tarefas"
                TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}" />

            <!-- Estatísticas em Cards -->
            <Grid ColumnDefinitions="*,*,*,*" ColumnSpacing="10">
                <!-- Card: Total -->
                <Border
                    Padding="12"
                    Stroke="{AppThemeBinding Light=#E0E0E0, Dark=#333333}"
                    StrokeShape="RoundRectangle 8"
                    StrokeThickness="1">
                    <VerticalStackLayout Spacing="3" HorizontalOptions="Center">
                        <Label
                            FontSize="12"
                            Text="Total"
                            TextColor="{AppThemeBinding Light=#666666, Dark=#AAAAAA}" />
                        <Label
                            FontSize="20"
                            FontAttributes="Bold"
                            Text="{Binding TotalTasks}"
                            TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}" />
                    </VerticalStackLayout>
                </Border>

                <!-- Card: A Fazer -->
                <Border
                    Grid.Column="1"
                    Padding="12"
                    Stroke="#9E9E9E"
                    StrokeShape="RoundRectangle 8"
                    StrokeThickness="1">
                    <VerticalStackLayout Spacing="3" HorizontalOptions="Center">
                        <Label
                            FontSize="12"
                            Text="A Fazer"
                            TextColor="#666666" />
                        <Label
                            FontSize="20"
                            FontAttributes="Bold"
                            Text="{Binding TodoTasks}"
                            TextColor="#9E9E9E" />
                    </VerticalStackLayout>
                </Border>

                <!-- Card: Em Progresso -->
                <Border
                    Grid.Column="2"
                    Padding="12"
                    Stroke="#2196F3"
                    StrokeShape="RoundRectangle 8"
                    StrokeThickness="1">
                    <VerticalStackLayout Spacing="3" HorizontalOptions="Center">
                        <Label
                            FontSize="12"
                            Text="Em Prog."
                            TextColor="#666666" />
                        <Label
                            FontSize="20"
                            FontAttributes="Bold"
                            Text="{Binding InProgressTasks}"
                            TextColor="#2196F3" />
                    </VerticalStackLayout>
                </Border>

                <!-- Card: Concluído -->
                <Border
                    Grid.Column="3"
                    Padding="12"
                    Stroke="#4CAF50"
                    StrokeShape="RoundRectangle 8"
                    StrokeThickness="1">
                    <VerticalStackLayout Spacing="3" HorizontalOptions="Center">
                        <Label
                            FontSize="12"
                            Text="Concluído"
                            TextColor="#666666" />
                        <Label
                            FontSize="20"
                            FontAttributes="Bold"
                            Text="{Binding CompletedTasks}"
                            TextColor="#4CAF50" />
                    </VerticalStackLayout>
                </Border>
            </Grid>

            <!-- Input para adicionar tarefa -->
            <VerticalStackLayout Spacing="10">
                <Label
                    FontSize="14"
                    FontAttributes="Bold"
                    Text="Nova Tarefa"
                    TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}" />

                <Entry
                    Placeholder="Digite o título da tarefa..."
                    Text="{Binding NewTaskTitle}"
                    FontSize="14"
                    BackgroundColor="{AppThemeBinding Light=#F8F8F8, Dark=#2A2A2A}"
                    TextColor="{AppThemeBinding Light=#333333, Dark=#FFFFFF}"
                    PlaceholderColor="{AppThemeBinding Light=#999999, Dark=#666666}"
                    HorizontalOptions="Fill" />

                <HorizontalStackLayout Spacing="10" HorizontalOptions="Fill">
                    <Label
                        Text="Prioridade:"
                        VerticalOptions="Center"
                        TextColor="{AppThemeBinding Light=#666666, Dark=#AAAAAA}" />
                    <Picker
                        Title="Prioridade"
                        SelectedItem="{Binding NewTaskPriority}"
                        HorizontalOptions="Fill"
                        FontSize="12"
                        BackgroundColor="{AppThemeBinding Light=#F8F8F8, Dark=#2A2A2A}"
                        TextColor="{AppThemeBinding Light=#333333, Dark=#FFFFFF}">
                        <Picker.ItemsSource>
                            <x:Array Type="{x:Type local:TaskPriority}">
                                <local:TaskPriority>Low</local:TaskPriority>
                                <local:TaskPriority>Medium</local:TaskPriority>
                                <local:TaskPriority>High</local:TaskPriority>
                            </x:Array>
                        </Picker.ItemsSource>
                    </Picker>

                    <Button
                        Text="Adicionar"
                        Command="{Binding AddTaskCommand}"
                        FontSize="12"
                        BackgroundColor="#4A90E2"
                        TextColor="White"
                        CornerRadius="6"
                        HorizontalOptions="End" />
                </HorizontalStackLayout>
            </VerticalStackLayout>
        </VerticalStackLayout>

        <!-- Lista de Tarefas -->
        <CollectionView
            Grid.Row="1"
            ItemsSource="{Binding Tasks}"
            SelectionMode="None">
            <CollectionView.ItemsLayout>
                <LinearItemsLayout Orientation="Vertical" ItemSpacing="12" />
            </CollectionView.ItemsLayout>
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Border
                        Padding="15"
                        Stroke="{Binding StatusColor}"
                        StrokeShape="RoundRectangle 10"
                        StrokeThickness="2">
                        <Grid RowDefinitions="auto,auto" ColumnDefinitions="*,auto" ColumnSpacing="10" RowSpacing="8">

                            <!-- Título e Status -->
                            <VerticalStackLayout Grid.Row="0" Grid.Column="0" Spacing="4">
                                <Label
                                    FontSize="16"
                                    FontAttributes="Bold"
                                    Text="{Binding Title}"
                                    TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}" />

                                <HorizontalStackLayout Spacing="8">
                                    <Label
                                        FontSize="11"
                                        Text="{Binding StatusDisplay}"
                                        Padding="6,2"
                                        BackgroundColor="{Binding StatusColor}"
                                        TextColor="White" />
                                    <Label
                                        FontSize="11"
                                        Text="{Binding PriorityDisplay}"
                                        Padding="6,2"
                                        BackgroundColor="{Binding PriorityColor}"
                                        TextColor="White" />
                                </HorizontalStackLayout>
                            </VerticalStackLayout>

                            <!-- Botões de Ação -->
                            <HorizontalStackLayout
                                Grid.Row="1"
                                Grid.Column="0"
                                Grid.ColumnSpan="2"
                                Spacing="8"
                                HorizontalOptions="End">
                                <Button
                                    Text="Start"
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type local:TasksPage}}, Path=BindingContext.StartTaskCommand}"
                                    CommandParameter="{Binding .}"
                                    FontSize="12"
                                    BackgroundColor="#2196F3"
                                    TextColor="White"
                                    CornerRadius="4"
                                    Padding="8"
                                    WidthRequest="40"
                                    HeightRequest="35"
                                    IsVisible="{Binding Status, Converter={StaticResource StatusToVisibilityConverter}}" />

                                <Button
                                    Text="Complete"
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type local:TasksPage}}, Path=BindingContext.CompleteTaskCommand}"
                                    CommandParameter="{Binding .}"
                                    FontSize="14"
                                    BackgroundColor="#4CAF50"
                                    TextColor="White"
                                    CornerRadius="4"
                                    Padding="8"
                                    WidthRequest="40"
                                    HeightRequest="35" />

                                <Button
                                    Text="Reset"
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type local:TasksPage}}, Path=BindingContext.ResetTaskCommand}"
                                    CommandParameter="{Binding .}"
                                    FontSize="12"
                                    BackgroundColor="#FF9800"
                                    TextColor="White"
                                    CornerRadius="4"
                                    Padding="8"
                                    WidthRequest="40"
                                    HeightRequest="35" />

                                <Button
                                    Text="Delete"
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type local:TasksPage}}, Path=BindingContext.DeleteTaskCommand}"
                                    CommandParameter="{Binding .}"
                                    FontSize="14"
                                    BackgroundColor="#F44336"
                                    TextColor="White"
                                    CornerRadius="4"
                                    Padding="8"
                                    WidthRequest="40"
                                    HeightRequest="35" />
                            </HorizontalStackLayout>
                        </Grid>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <!-- Loading Indicator -->
        <ActivityIndicator
            Grid.Row="1"
            HorizontalOptions="Center"
            IsRunning="{Binding IsLoading}"
            IsVisible="{Binding IsLoading}"
            VerticalOptions="Center"
            Color="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource Primary}}" />
    </Grid>
</ContentPage>
